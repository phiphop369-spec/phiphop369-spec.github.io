<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Surprise for Ouan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;600&family=Caveat:wght@700&family=Mitr:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #ff85a1;
            --deep-red: #ff4d6d;
            --envelope-bg: #ffb3c1;
            --envelope-dark: #ff8fa3;
            --paper-bg: #fffbf0;
            --text-pink-deep: #d63384;
        }
        body {
            font-family: 'Anuphan', sans-serif;
            background-color: #fff0f3;
            overflow-x: hidden;
            margin: 0;
        }
        .handwritten { font-family: 'Caveat', cursive; }
        .title-font { font-family: 'Mitr', sans-serif; }

        /* Background hearts (Global) */
        .heart-particle {
            position: fixed;
            pointer-events: none;
            z-index: 1;
            animation: moveUp 4s linear forwards;
        }
        
        /* Balloon-like heart burst */
        .burst-heart {
            position: absolute;
            pointer-events: none;
            z-index: 100;
            animation: balloonRise var(--duration) ease-in-out forwards;
            opacity: 0;
        }

        @keyframes moveUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        @keyframes balloonRise {
            0% { transform: translate(-50%, 0) scale(0); opacity: 0; }
            10% { opacity: 1; transform: translate(var(--drift-start), -30px) scale(1.2); }
            50% { transform: translate(calc(var(--drift-start) * 1.5), -50vh) scale(1.1) rotate(10deg); }
            100% { transform: translate(var(--drift-end), -115vh) scale(1) rotate(var(--tr)); opacity: 0; }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .hidden-page {
            display: none;
            opacity: 0;
        }

        /* --- Envelope CSS --- */
        .envelope-container {
            perspective: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding-top: 50px;
        }

        .envelope-wrapper {
            position: relative;
            width: 280px;
            height: 180px;
            background: var(--envelope-bg);
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.4s ease;
            transform: translateY(50px);
        }

        @media (min-width: 768px) {
            .envelope-wrapper { width: 340px; height: 220px; }
        }

        .flap {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            border-top: 120px solid var(--envelope-dark);
            border-left: 140px solid transparent;
            border-right: 140px solid transparent;
            transform-origin: top;
            transition: transform 0.5s ease, z-index 0.1s 0.2s;
            z-index: 4;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));
        }
        @media (min-width: 768px) {
            .flap { border-top-width: 150px; border-left-width: 170px; border-right-width: 170px; }
        }

        .pockets {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            border-top: 90px solid transparent;
            border-left: 140px solid var(--envelope-bg);
            border-right: 140px solid var(--envelope-bg);
            border-bottom: 90px solid var(--envelope-bg);
            border-radius: 12px;
        }
        @media (min-width: 768px) {
            .pockets { border-top-width: 110px; border-left-width: 170px; border-right-width: 170px; border-bottom-width: 110px; }
        }

        .letter {
            position: absolute;
            bottom: 5px;
            left: 5%;
            width: 90%;
            height: 90%;
            background: var(--paper-bg);
            z-index: 2;
            transition: transform 0.5s ease, height 0.5s ease, z-index 0s 0.25s;
            padding: 10px 15px;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.03);
            border-radius: 4px;
            overflow: hidden;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        .envelope-wrapper.open .flap { transform: rotateX(180deg); z-index: 1; }
        .envelope-wrapper.open .letter { transform: translateY(-40%); height: 115%; z-index: 5; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        .wax-seal {
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; background: #d00000; border-radius: 50%; z-index: 10;
            display: flex; align-items: center; justify-content: center; color: white;
            font-size: 16px; box-shadow: 0 3px 8px rgba(0,0,0,0.2); transition: opacity 0.3s ease;
        }
        .envelope-wrapper.open .wax-seal { opacity: 0; pointer-events: none; }

        .pass-input { letter-spacing: 0.5em; text-align: center; font-size: 1.5rem; }
        
        .letter-content {
            font-size: 0.7rem; line-height: 1.1; color: var(--text-pink-deep);
            display: flex; flex-direction: column; gap: 1px; width: 100%;
        }

        @media (min-width: 768px) {
            .letter-content { font-size: 0.85rem; line-height: 1.25; gap: 3px; }
        }
        
        .letter-header { color: var(--text-pink-deep); font-weight: bold; font-size: 0.75rem; margin-bottom: 0.2rem; }

        .letter-footer-link {
            color: #fff; background: var(--deep-red); padding: 4px 12px; border-radius: 20px;
            font-weight: bold; font-size: 0.8rem; margin-top: 0.5rem; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .envelope-label {
            position: absolute; bottom: 15px; right: 20px; z-index: 15; pointer-events: none; transition: opacity 0.3s ease;
        }
        .envelope-wrapper.open .envelope-label { opacity: 0; }

        /* --- Page 3: Pink Dive Styles --- */
        #page-3-pink {
            position: fixed; inset: 0; 
            background: linear-gradient(45deg, #ff0a54, #ff477e, #ff7096, #ff85a1);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite; 
            z-index: 500;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 2s ease-in-out; overflow: hidden;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .white-heart {
            position: absolute; top: -50px; color: white; pointer-events: none; z-index: 501;
            animation: fall linear forwards; opacity: 0.8; filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        @keyframes fall {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        .page3-text {
            font-size: 1.5rem !important; margin-bottom: 2.5rem !important;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        @media (min-width: 768px) { .page3-text { font-size: 2.25rem !important; } }

        .dive-btn-sm {
            position: relative; z-index: 600; background: white; color: #ff0a54; padding: 10px 28px; 
            border-radius: 40px; font-weight: 700; font-size: 1rem; box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            border: 2px solid #ff0a54; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
        }

        #noButtonSm {
            position: relative; z-index: 600; background: rgba(0, 0, 0, 0.4); color: white; font-weight: 600;
            padding: 8px 20px; font-size: 0.85rem; border-radius: 40px; border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(8px); transition: left 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.2s ease;
        }

        /* --- Page 4: Digging Game Styles --- */
        .dig-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
            max-width: 400px; margin: 0 auto;
        }
        .dig-item {
            aspect-ratio: 1/1; background: #ffe5ec; border-radius: 1.5rem;
            display: flex; align-items: center; justify-content: center; font-size: 2rem;
            cursor: pointer; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white; box-shadow: 0 4px 10px rgba(255, 133, 161, 0.2); position: relative;
        }
        .dig-item:hover { transform: scale(1.05); background: #ffc2d1; }
        .dig-item.dug { background: white; cursor: default; transform: scale(0.95); border-color: #ff85a1; }
        .message-reveal {
            position: fixed; bottom: 15%; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 500px; background: white; padding: 20px;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center; opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease, transform 0.5s ease; z-index: 100;
        }
        .message-reveal.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        /* --- Next Button in Page 4 --- */
        #nextToPage5 {
            position: fixed; bottom: 20px; right: 20px; z-index: 200;
            background: #ff4d6d; color: white; font-weight: 600; padding: 10px 20px;
            border-radius: 30px; box-shadow: 0 4px 15px rgba(255, 77, 109, 0.4);
            transition: all 0.3s ease; opacity: 0; pointer-events: none;
        }
        #nextToPage5.active { opacity: 1; pointer-events: auto; animation: bounceRight 1.5s infinite; }

        @keyframes bounceRight {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        /* --- Page 5: Rearrange Words Styles --- */
        #scratch-page {
            display: none; opacity: 0; transition: opacity 1s ease-in-out;
            min-height: 100vh; background: #fff0f3; padding: 2rem 1rem;
            flex-direction: column; align-items: center;
        }
        
        .word-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            width: 100%; max-width: 450px; margin-bottom: 2rem;
        }

        .scratch-box-p5 {
            position: relative; aspect-ratio: 1/1; background: white; border-radius: 1rem;
            overflow: hidden; border: 2px solid #ff85a1; box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
        }

        .scratch-canvas-p5 {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20; cursor: crosshair; touch-action: none;
        }

        .word-behind {
            font-size: 1.2rem; font-weight: bold; color: #ff4d6d; z-index: 10;
        }

        .inventory-area {
            width: 100%; max-width: 450px; min-height: 60px; background: rgba(255, 255, 255, 0.5);
            border: 2px dashed #ffb3c1; border-radius: 1rem; padding: 10px;
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 1rem;
        }

        .answer-input-area {
            width: 100%; max-width: 450px; min-height: 80px; background: white;
            border: 2px solid #ff85a1; border-radius: 1.5rem; padding: 15px;
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            transition: border-color 0.3s ease;
        }

        .word-chip {
            background: #ff4d6d; color: white; padding: 8px 16px; border-radius: 20px;
            font-weight: 600; cursor: pointer; transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); user-select: none;
        }
        .word-chip:hover { transform: scale(1.05); background: #ff758f; }
        .word-chip:active { transform: scale(0.95); }

        .chip-in-answer {
            background: white; color: #ff4d6d; border: 1.5px solid #ff4d6d;
        }

        .victory-msg {
            margin-top: 2rem; text-align: center; display: none;
        }

        .error-msg {
            color: #d00000; font-weight: bold; margin-top: 10px; opacity: 0; transition: opacity 0.3s ease;
        }

        .victory-glow {
            animation: textGlow 1s infinite alternate;
        }

        @keyframes textGlow {
            from { text-shadow: 0 0 5px #fff, 0 0 10px #ff4d6d; transform: scale(1); }
            to { text-shadow: 0 0 10px #fff, 0 0 20px #ff4d6d; transform: scale(1.1); }
        }

        /* --- Page 6: Final Message Styles --- */
        #final-page {
            display: none; opacity: 0; transition: opacity 1.5s ease;
            min-height: 100vh; background: #fff0f3; padding: 2rem;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .floating-photo {
            width: 260px; 
            background: white; border: 12px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); transform: rotate(-3deg);
            margin-bottom: 2rem; border-radius: 4px; overflow: hidden;
            animation: floatPhoto 4s ease-in-out infinite;
            display: flex; align-items: center; justify-content: center;
            min-height: 200px;
        }
        .floating-photo img {
            width: 100%; height: auto; display: block;
        }
        @keyframes floatPhoto {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-15px) rotate(3deg); }
        }

        /* --- Final Shower Overlay --- */
        .shower-heart {
            position: fixed;
            top: -100px;
            z-index: 3000;
            pointer-events: none;
            animation: heartFall var(--fall-duration) linear forwards;
            filter: drop-shadow(0 0 5px rgba(255, 0, 0, 0.2));
        }
        @keyframes heartFall {
            0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; }
            10% { opacity: 1; transform: translateY(10vh) rotate(30deg) scale(1); }
            90% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg) scale(1.2); opacity: 0; }
        }
    </style>
</head>
<body class="text-gray-800">

    <div id="heart-container"></div>

    <!-- PAGE 1: LOGIN -->
    <section id="login-page" class="relative z-10 min-h-screen flex items-center justify-center p-4">
        <div class="glass-card p-8 md:p-12 rounded-[2rem] shadow-2xl max-w-md w-full text-center border-2 border-pink-200">
            <div class="text-5xl mb-6">üîí</div>
            <h2 class="title-font text-2xl font-bold text-red-600 mb-2">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</h2>
            <p class="text-gray-500 mb-8">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏±‡∏ß‡πÉ‡∏à...</p>
            <div class="mb-8 text-left">
                <label class="block text-sm font-medium text-pink-600 mb-4 text-center">‡πÄ‡∏£‡∏≤‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà? (‡∏ß‡∏ß‡∏î‡∏î‡∏õ‡∏õ)</label>
                <input type="password" id="password" maxlength="6" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="pass-input w-full bg-white border-2 border-pink-200 rounded-2xl py-4 focus:outline-none focus:border-red-400 transition-all text-red-500 font-bold">
                <p id="error-msg" class="text-red-500 text-sm mt-3 hidden text-center">‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏ô‡∏∞‡∏≠‡πâ‡∏ß‡∏ô ‡∏•‡∏≠‡∏á‡∏ô‡∏∂‡∏Å‡∏î‡∏π‡∏î‡∏µ‡πÜ ‡∏ã‡∏¥! ü•∫</p>
            </div>
            <button onclick="checkPassword()" class="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold py-4 rounded-2xl shadow-lg hover:scale-105 active:scale-95 transition">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö ‚ú®</button>
        </div>
    </section>

    <!-- PAGE 2: ENVELOPE -->
    <section id="envelope-page" class="hidden-page relative z-10 min-h-screen flex flex-col items-center justify-center p-4">
        <div class="envelope-container" id="burst-origin">
            <div class="envelope-wrapper" id="mainEnvelope" onclick="toggleEnvelope(event)">
                <div class="flap"></div>
                <div class="pockets"></div>
                <div class="wax-seal">‚ù§Ô∏è</div>
                <div class="envelope-label handwritten text-pink-700 text-xl md:text-2xl">To: ‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</div>
                <div class="letter">
                    <p class="letter-header">‡∏ñ‡∏∂‡∏á: ‡∏Ñ‡∏ô‡∏≠‡πâ‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å</p>
                    <div class="letter-content handwritten">
                        <span>‡∏≠‡πâ‡∏ß‡∏ô‡∏ö‡∏∏‡πã‡∏°‡πÜ ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏∞</span>
                        <span>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏°‡∏≤‡∏Å‡πÜ‡∏ô‡∏∞</span>
                        <span>‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏û‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏ô‡∏±‡∏Å</span>
                        <span>‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
                        <span>‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÇ‡∏£‡πÅ‡∏°‡∏ô‡∏ï‡∏¥‡∏Å ‡πÅ‡∏ï‡πà‡∏û‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏≠‡πâ‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÜ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</span>
                        <span>‡∏£‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÜ‡∏ô‡∏∞‡∏Ñ‡∏∞ ‡∏à‡∏∏‡πä‡∏ö‡πÜ üòò</span>
                    </div>
                    <div class="letter-footer-link handwritten" onclick="goToPage3()">‡∏Å‡∏î‡∏ô‡∏µ‡πà‡∏î‡∏π‡∏™‡∏¥</div>
                </div>
            </div>
        </div>
    </section>

    <!-- PAGE 3: PINK DIVE -->
    <section id="page-3-pink">
        <div id="rain-container" class="absolute inset-0 pointer-events-none"></div>
        <div class="text-center px-6 relative z-10">
            <h3 class="title-font page3-text font-bold text-white drop-shadow-lg">‡∏≠‡πâ‡∏ß‡∏ô‡∏£‡∏±‡∏Å‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà‡∏°‡∏±‡πâ‡∏¢üòõ</h3>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-6">
                <button onclick="acceptLoveFromPage3()" class="dive-btn-sm">‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏î‡∏î! ‚ú®</button>
                <button id="noButtonSm" onmouseover="moveButton()" onclick="moveButton()">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏Å‡∏´‡∏´‡∏£‡∏≠‡∏Å ‡πÅ‡∏ö‡∏£‡πà!</button>
            </div>
        </div>
    </section>

    <!-- PAGE 4: DIGGING GAME -->
    <section id="main-content" class="hidden-page relative z-10 py-16 px-4">
        <header class="text-center mb-10">
            <div class="text-red-500 text-5xl mb-4 animate-bounce">‚õèÔ∏èüíñ</div>
            <h1 class="title-font text-3xl md:text-5xl font-bold text-red-600 mb-2">‡∏Ç‡∏∏‡∏î‡∏´‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà</h1>
            <p class="text-lg text-pink-500 handwritten">‡∏•‡∏≠‡∏á‡∏Ç‡∏∏‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏û‡∏ß‡∏Å‡∏ô‡∏µ‡πâ‡∏î‡∏π‡∏™‡∏¥ ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà...</p>
        </header>

        <div class="dig-grid" id="dig-grid">
            <!-- Items will be generated by JS -->
        </div>

        <div id="message-display" class="message-reveal handwritten text-2xl text-pink-600">
            <!-- Messages will appear here -->
        </div>

        <div id="final-surprise" class="hidden mt-12 text-center glass-card p-8 rounded-[2rem] max-w-lg mx-auto border-4 border-dashed border-pink-400 mb-20">
            <h2 class="title-font text-2xl font-bold text-red-600 mb-4">‡∏Ç‡∏∏‡∏î‡∏à‡∏ô‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á...</h2>
            <p class="text-gray-700 leading-relaxed mb-6">
                ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ç‡∏∏‡∏î‡πÄ‡∏à‡∏≠‡∏≠‡∏∞‡πÑ‡∏£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏∑‡∏≠... <br>
                <span class="text-3xl text-pink-600 font-bold handwritten">‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏≠‡πâ‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏∞!</span> <br>
                ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ô‡∏î‡∏µ üíñ
            </p>
            <div class="text-5xl">üë©‚Äç‚ù§Ô∏è‚Äçüë®</div>
        </div>

        <button id="nextToPage5" onclick="goToPage5()">‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞ ‚ûî</button>
    </section>

    <!-- PAGE 5: REARRANGE GAME -->
    <section id="scratch-page">
        <div class="text-center mb-8">
            <h2 class="title-font text-3xl font-bold text-red-600">‡∏Ç‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏≥ üíñ</h2>
            <p class="text-pink-500 mt-2 font-medium">‡∏Ç‡∏∏‡∏î‡∏´‡∏≤‡∏Ñ‡∏≥‡πÅ‡∏•‡∏∞ ‚ù§Ô∏è ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏∞‡∏≠‡πâ‡∏ß‡∏ô</p>
        </div>

        <div class="word-grid" id="word-grid-p5">
            <!-- Word Scratch Boxes -->
        </div>

        <div class="w-full max-w-md text-center">
            <label class="text-xs font-bold text-pink-400 uppercase tracking-widest mb-2 block">‡∏Ñ‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏Ç‡∏∏‡∏î‡πÄ‡∏à‡∏≠</label>
            <div class="inventory-area" id="p5-inventory">
                <!-- Found words appear here -->
            </div>
        </div>

        <div class="w-full max-w-md text-center mt-4">
            <label class="text-xs font-bold text-red-400 uppercase tracking-widest mb-2 block">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏≠‡∏≠‡∏Å)</label>
            <div class="answer-input-area" id="p5-answer">
                <!-- Rearrange area -->
            </div>
            <p id="p5-error-text" class="error-msg">‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏∞‡∏≠‡πâ‡∏ß‡∏ô ‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ã‡∏¥! ü•∫</p>
        </div>

        <div id="p5-victory" class="victory-msg">
            <div class="text-6xl mb-4">ü•∞üíù‚ú®</div>
            <h3 class="title-font text-3xl font-bold text-red-600 victory-glow">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏î‡∏î!</h3>
            <p id="p5-final-text" class="text-pink-600 mt-2 handwritten text-2xl">‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏î‡∏≠‡∏Å‡∏´‡∏ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡πÄ‡∏•‡∏¢‡∏ô‡∏∞</p>
            <button onclick="goToPage6()" class="mt-8 bg-pink-500 text-white px-10 py-3 rounded-full font-bold shadow-lg flex items-center gap-2 mx-auto">‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚ûî</button>
        </div>
    </section>

    <!-- PAGE 6: FINAL MESSAGE -->
    <section id="final-page">
        <div class="floating-photo" id="final-photo-container">
            <!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤ ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏™‡πà‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </div>
        <h2 class="title-font text-4xl font-bold text-red-600 mb-6">Happy Valentine's Day</h2>
        <div class="glass-card p-8 rounded-[2rem] max-w-lg mx-auto border-2 border-pink-200">
            <p class="text-xl text-gray-700 leading-relaxed handwritten">
                ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡πâ‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏û‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏Å <br>
                ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Ç‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô <br>
                ‡∏à‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏≠‡πâ‡∏ß‡∏ô‡πÉ‡∏´‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ <br>
                ‡∏£‡∏±‡∏Å‡∏î‡∏≠‡∏Å‡∏´‡∏ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡πÄ‡∏•‡∏¢! <br>
                <span class="text-3xl text-red-500 mt-4 block font-bold">‡∏à‡∏µ‡πà&‡∏î‡∏≠‡∏Å‡∏´‡∏ç‡πâ‡∏≤ ‚ù§Ô∏è</span>
            </p>
        </div>
        <button id="endGameBtn" onclick="finishGame()" class="mt-10 bg-white text-pink-500 border-2 border-pink-200 px-8 py-3 rounded-full hover:bg-pink-50 transition font-bold text-lg shadow-sm">‡∏à‡∏ö‡∏ö‡∏£‡∏¥‡∏ö‡∏π‡∏£‡∏ì‡πå ‚ú®</button>
    </section>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/70 hidden z-[1000] flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-10 max-w-md w-full text-center shadow-2xl">
            <div class="text-7xl mb-6">üéâüíñ</div>
            <h2 class="text-3xl font-bold text-red-600 mb-4 title-font">‡∏£‡∏π‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏Å‡∏Å‡∏Å!</h2>
            <p class="mb-6 text-gray-500">‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏Ç‡∏∏‡∏î‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢‡∏à‡πâ‡∏≤</p>
            <button onclick="closeModal()" class="bg-pink-500 text-white w-full py-4 rounded-2xl font-bold shadow-lg">‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢! ‚õèÔ∏è</button>
        </div>
    </div>

    <script>
        const apiKey = ""; 
        let burstHappened = false;
        let rainInterval = null;
        let dugCount = 0;
        const totalItems = 9;

        // ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô Base64 ‡∏´‡∏£‡∏∑‡∏≠ URL ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô placeholder ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£
        // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
        const userImageSrc = "https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=1000&auto=format&fit=crop"; 
        
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡πÉ‡∏ô‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°‡∏ô‡∏µ‡πâ 
        // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ù‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö‡∏ù‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤ URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö 
        // ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö AI ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏ó

        const messages = [
            "‡∏£‡∏±‡∏Å‡∏≠‡πâ‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚ù§Ô∏è", "‡∏Ñ‡∏ô‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà üíñ", "‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏∑‡πâ‡∏≠‡∏ô‡∏∞‡∏≠‡πâ‡∏ß‡∏ô ‚ú®",
            "‡∏à‡∏∏‡πä‡∏ö‡πÜ ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏µ üòò", "‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏¢ ü•∞", "‡∏≠‡πâ‡∏ß‡∏ô‡∏û‡∏∏‡∏á‡∏ô‡∏¥‡πà‡∏° üê∑",
            "‡∏≠‡∏¢‡∏≤‡∏Å‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ‡∏ô‡∏∞ üë©‚Äç‚ù§Ô∏è‚Äçüë®", "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏ß‡∏¢‡∏à‡∏±‡∏á‡πÄ‡∏•‡∏¢ (‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏ô‡∏∞) üåπ", "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ç‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà üëë"
        ];

        // Page 5 Data
        const secretWords = ["‡∏û‡∏µ‡πà", "‡∏à‡∏µ‡πà", "‡∏£‡∏±‡∏Å", "‡∏î‡∏≠‡∏Å", "‡∏´‡∏ç‡πâ‡∏≤", "‡∏ó‡∏µ‡πà", "‡∏™‡∏∏‡∏î", "‚ù§Ô∏è"];
        const targetStr1 = "‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏î‡∏≠‡∏Å‡∏´‡∏ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‚ù§Ô∏è";

        let foundWords = []; 
        let userSequence = []; 

        function checkPassword() {
            if (document.getElementById('password').value === "240568") {
                document.getElementById('login-page').style.display = 'none';
                const envPage = document.getElementById('envelope-page');
                envPage.style.display = 'flex';
                setTimeout(() => envPage.style.opacity = '1', 50);
            } else {
                document.getElementById('error-msg').classList.remove('hidden');
                document.getElementById('password').value = "";
            }
        }

        function burstHearts() {
            if (burstHappened) return;
            burstHappened = true;
            const origin = document.getElementById('burst-origin');
            for (let i = 0; i < 35; i++) {
                const heart = document.createElement('div');
                heart.classList.add('burst-heart');
                heart.innerText = ['‚ù§Ô∏è', 'üíñ', 'üíò', 'üíï', '‚ú®'][Math.floor(Math.random() * 5)];
                const duration = (Math.random() * 3 + 7) + 's'; 
                const driftStart = (Math.random() - 0.5) * 450 + 'px';
                const driftEnd = (Math.random() - 0.5) * 700 + 'px';
                const tr = (Math.random() * 60 - 30) + 'deg'; 
                heart.style.setProperty('--duration', duration);
                heart.style.setProperty('--drift-start', driftStart);
                heart.style.setProperty('--drift-end', driftEnd);
                heart.style.setProperty('--tr', tr);
                heart.style.left = '50%'; heart.style.top = '45%';
                heart.style.fontSize = (Math.random() * 15 + 20) + 'px';
                origin.appendChild(heart);
                setTimeout(() => heart.remove(), 12000);
            }
        }

        function toggleEnvelope(event) {
            const env = document.getElementById('mainEnvelope');
            if (event.target.classList.contains('letter-footer-link')) return;
            if (!env.classList.contains('open')) {
                env.classList.add('open');
                setTimeout(burstHearts, 50);
            } else {
                env.classList.remove('open');
            }
        }

        function createWhiteHeartRain() {
            const container = document.getElementById('rain-container');
            const heart = document.createElement('div');
            heart.classList.add('white-heart');
            heart.innerText = 'ü§ç';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.fontSize = (Math.random() * 15 + 10) + 'px';
            heart.style.animationDuration = (Math.random() * 3 + 4) + 's';
            heart.style.opacity = Math.random() * 0.5 + 0.3;
            container.appendChild(heart);
            setTimeout(() => heart.remove(), 7000);
        }

        function goToPage3() {
            const envPage = document.getElementById('envelope-page');
            const page3 = document.getElementById('page-3-pink');
            envPage.style.transition = 'opacity 1s ease-in-out';
            envPage.style.opacity = '0';
            setTimeout(() => {
                envPage.style.display = 'none';
                page3.style.display = 'flex';
                setTimeout(() => {
                    page3.style.opacity = '1';
                    if (!rainInterval) rainInterval = setInterval(createWhiteHeartRain, 200);
                }, 100);
            }, 1000);
        }

        function acceptLoveFromPage3() {
            document.getElementById('successModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
            const page3 = document.getElementById('page-3-pink');
            const mainContent = document.getElementById('main-content');
            if (rainInterval) { clearInterval(rainInterval); rainInterval = null; }
            page3.style.opacity = '0';
            setTimeout(() => {
                page3.style.display = 'none';
                mainContent.style.display = 'block';
                setTimeout(() => {
                    mainContent.style.opacity = '1';
                    initDigGame();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 50);
            }, 500);
        }

        function initDigGame() {
            const grid = document.getElementById('dig-grid');
            grid.innerHTML = '';
            dugCount = 0;
            const shuffled = [...messages].sort(() => Math.random() - 0.5);
            for (let i = 0; i < totalItems; i++) {
                const item = document.createElement('div');
                item.classList.add('dig-item');
                item.innerText = 'üéÅ';
                item.onclick = () => dig(item, shuffled[i]);
                grid.appendChild(item);
            }
        }

        function dig(el, msg) {
            if (el.classList.contains('dug')) return;
            el.classList.add('dug');
            el.innerText = 'üíù';
            dugCount++;
            const display = document.getElementById('message-display');
            display.innerText = msg;
            display.classList.add('show');
            for(let i=0; i<5; i++) { createParticleAt(el); }
            if (dugCount === totalItems) {
                setTimeout(() => {
                    document.getElementById('final-surprise').classList.remove('hidden');
                    document.getElementById('nextToPage5').classList.add('active');
                }, 1000);
            }
            setTimeout(() => {
                if (display.innerText === msg) display.classList.remove('show');
            }, 2500);
        }

        function goToPage5() {
            const mainContent = document.getElementById('main-content');
            const scratchPage = document.getElementById('scratch-page');
            mainContent.style.opacity = '0';
            setTimeout(() => {
                mainContent.style.display = 'none';
                scratchPage.style.display = 'flex';
                setTimeout(() => { 
                    scratchPage.style.opacity = '1'; 
                    initPage5();
                }, 100);
            }, 1000);
        }

        function initPage5() {
            const grid = document.getElementById('word-grid-p5');
            grid.innerHTML = '';
            foundWords = [];
            userSequence = [];
            updateInventoryUI();
            updateAnswerUI();
            document.getElementById('p5-victory').style.display = 'none';
            document.getElementById('p5-error-text').style.opacity = '0';

            const shuffled = [...secretWords].sort(() => Math.random() - 0.5);
            shuffled.forEach((word) => {
                const box = document.createElement('div');
                box.className = 'scratch-box-p5';
                const wordEl = document.createElement('div');
                wordEl.className = 'word-behind';
                wordEl.innerText = word;
                box.appendChild(wordEl);
                const canvas = document.createElement('canvas');
                canvas.className = 'scratch-canvas-p5';
                box.appendChild(canvas);
                grid.appendChild(box);
                setupScratchP5(canvas, word);
            });
        }

        function setupScratchP5(canvas, word) {
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width || 100;
            canvas.height = rect.height || 100;
            ctx.fillStyle = '#ff4d6d';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('‡∏Ç‡∏π‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ', canvas.width/2, canvas.height/2 + 5);

            let isDrawing = false;
            let collected = false;

            function scratch(e) {
                if (!isDrawing) return;
                const r = canvas.getBoundingClientRect();
                const x = (e.clientX || (e.touches ? e.touches[0].clientX : 0)) - r.left;
                const y = (e.clientY || (e.touches ? e.touches[0].clientY : 0)) - r.top;
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, 15, 0, Math.PI * 2);
                ctx.fill();

                if (!collected) {
                    const pixels = ctx.getImageData(0,0,canvas.width,canvas.height).data;
                    let blank = 0;
                    for(let i=3; i<pixels.length; i+=4) if(pixels[i] === 0) blank++;
                    if (blank > (canvas.width * canvas.height * 0.4)) {
                        collected = true;
                        canvas.style.transition = 'opacity 0.5s';
                        canvas.style.opacity = '0';
                        setTimeout(() => {
                            canvas.remove();
                            addWordToInventory(word);
                        }, 500);
                    }
                }
            }
            canvas.addEventListener('mousedown', () => isDrawing = true);
            canvas.addEventListener('touchstart', (e) => { isDrawing = true; e.preventDefault(); }, {passive:false});
            window.addEventListener('mouseup', () => isDrawing = false);
            window.addEventListener('touchend', () => isDrawing = false);
            canvas.addEventListener('mousemove', scratch);
            canvas.addEventListener('touchmove', (e) => { scratch(e); e.preventDefault(); }, {passive:false});
        }

        function addWordToInventory(word) {
            foundWords.push(word);
            updateInventoryUI();
            createParticleAt(document.getElementById('p5-inventory'));
        }

        function updateInventoryUI() {
            const inv = document.getElementById('p5-inventory');
            inv.innerHTML = '';
            let tempUserSeq = [...userSequence];
            foundWords.forEach((word) => {
                const usedIndex = tempUserSeq.indexOf(word);
                if (usedIndex > -1) {
                    tempUserSeq.splice(usedIndex, 1);
                } else {
                    const chip = document.createElement('div');
                    chip.className = 'word-chip';
                    chip.innerText = word;
                    chip.onclick = () => addToAnswer(word);
                    inv.appendChild(chip);
                }
            });
        }

        function addToAnswer(word) {
            userSequence.push(word);
            updateInventoryUI();
            updateAnswerUI();
            checkVictoryP5();
        }

        function removeFromAnswer(index) {
            userSequence.splice(index, 1);
            updateInventoryUI();
            updateAnswerUI();
            checkVictoryP5(); 
        }

        function updateAnswerUI() {
            const area = document.getElementById('p5-answer');
            area.innerHTML = '';
            userSequence.forEach((word, index) => {
                const chip = document.createElement('div');
                chip.className = 'word-chip chip-in-answer';
                chip.innerText = word;
                chip.onclick = () => removeFromAnswer(index);
                area.appendChild(chip);
            });
            area.style.borderColor = '#ff85a1';
            area.classList.remove('victory-glow');
        }

        function checkVictoryP5() {
            const currentStr = userSequence.join('');
            const errorText = document.getElementById('p5-error-text');
            const area = document.getElementById('p5-answer');

            if (userSequence.length < secretWords.length) {
                errorText.style.opacity = '0';
                area.style.borderColor = '#ff85a1';
            }

            if (currentStr === targetStr1) {
                document.getElementById('p5-victory').style.display = 'block';
                area.classList.add('victory-glow');
                area.style.borderColor = '#22c55e';
                errorText.style.opacity = '0';
                const footerText = document.getElementById('p5-final-text');
                footerText.innerText = "‡∏û‡∏µ‡πà‡∏à‡∏µ‡πà‡∏£‡∏±‡∏Å‡∏î‡∏≠‡∏Å‡∏´‡∏ç‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ ‚ù§Ô∏è";
                for(let i=0; i<60; i++) setTimeout(createHeart, i * 80);
            } else if (userSequence.length === secretWords.length) {
                errorText.style.opacity = '1';
                area.style.borderColor = '#d00000';
            }
        }

        function goToPage6() {
            const page5 = document.getElementById('scratch-page');
            const finalPage = document.getElementById('final-page');
            
            // ‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡∏á‡πÉ‡∏ô container
            const photoContainer = document.getElementById('final-photo-container');
            photoContainer.innerHTML = `<img src="${userImageSrc}" alt="Our Love Memory" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=1000&auto=format&fit=crop';">`;

            page5.style.opacity = '0';
            setTimeout(() => {
                page5.style.display = 'none';
                finalPage.style.display = 'flex';
                setTimeout(() => {
                    finalPage.style.opacity = '1';
                    for(let i=0; i<20; i++) setTimeout(createHeart, i * 200);
                }, 100);
            }, 1000);
        }

        function finishGame() {
            const btn = document.getElementById('endGameBtn');
            btn.disabled = true;
            btn.innerText = "‡∏£‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚ù§Ô∏è";

            const heartVarieties = ['‚ù§Ô∏è', 'üíñ', 'üíù', 'üíï', 'üíó', 'üíì', 'üíò', '‚ú®', 'üå∏', 'üåπ'];
            
            const showerInterval = setInterval(() => {
                for(let i=0; i<3; i++) {
                    const heart = document.createElement('div');
                    heart.classList.add('shower-heart');
                    heart.innerText = heartVarieties[Math.floor(Math.random() * heartVarieties.length)];
                    heart.style.left = (Math.random() * 110 - 5) + 'vw';
                    heart.style.fontSize = (Math.random() * 40 + 30) + 'px';
                    heart.style.setProperty('--fall-duration', (Math.random() * 1.5 + 1.5) + 's');
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), 3500);
                }
            }, 30);

            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.backgroundColor = '#fff0f3';
            overlay.style.zIndex = '2500';
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 3s ease';
            overlay.style.pointerEvents = 'none';
            document.body.appendChild(overlay);
            
            setTimeout(() => { overlay.style.opacity = '1'; }, 1000);

            setTimeout(() => {
                clearInterval(showerInterval);
                location.reload();
            }, 5000);
        }

        function createParticleAt(el) {
            const rect = el.getBoundingClientRect();
            const p = document.createElement('div');
            p.innerText = '‚ú®';
            p.style.position = 'fixed';
            p.style.left = (rect.left + rect.width/2) + 'px';
            p.style.top = (rect.top + rect.height/2) + 'px';
            p.style.pointerEvents = 'none';
            p.style.zIndex = '200';
            p.style.transition = 'all 0.8s ease-out';
            document.body.appendChild(p);
            setTimeout(() => {
                p.style.transform = `translate(${(Math.random()-0.5)*100}px, ${(Math.random()-0.5)*100}px) scale(0)`;
                p.style.opacity = '0';
            }, 50);
            setTimeout(() => p.remove(), 1000);
        }

        function createHeart() {
            const container = document.getElementById('heart-container');
            const heart = document.createElement('div');
            heart.classList.add('heart-particle');
            heart.innerText = ['‚ù§Ô∏è', 'üíñ', '‚ú®', 'üåπ'][Math.floor(Math.random()*4)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.fontSize = (Math.random() * 20 + 15) + 'px';
            container.appendChild(heart);
            setTimeout(() => heart.remove(), 4000);
        }
        setInterval(createHeart, 1500);

        function moveButton() {
            const btn = document.getElementById('noButtonSm');
            const padding = 80;
            const winWidth = window.innerWidth;
            const winHeight = window.innerHeight;
            const newLeft = Math.random() * (winWidth - (btn.offsetWidth + (padding * 2))) + padding;
            const newTop = Math.random() * (winHeight - (btn.offsetHeight + (padding * 2))) + padding;
            btn.style.position = 'fixed';
            btn.style.left = `${newLeft}px`; btn.style.top = `${newTop}px`;
            btn.style.transform = `rotate(${(Math.random() * 20 - 10)}deg)`;
        }
    </script>
</body>
</html>
